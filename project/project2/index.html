<!DOCTYPE html>
<html lang="en-us">
    <head>
         
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
        <link rel="manifest" href="/site.webmanifest">
        <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
        <meta name="msapplication-TileColor" content="#da532c">
        <meta name="theme-color" content="#ffffff">
        <title>Multi-server broadcast system</title>
        
        <style>

    html body {
        font-family: 'Raleway', sans-serif;
        background-color: white;
    }

    :root {
        --accent: #007FFF;
        --border-width:  5px ;
    }

   .myname {
    font-size: 20px;
    }
    
    #topBtn {
        display: none;  
        position: fixed;  
        bottom: 60px;  
        right: 20px;  
        z-index: 99;  
        border: none;  
        outline: none;  
        background-color: transparent;  
        color:#777;   
    }
    #botBtn {
       
        position: fixed;  
        bottom: 20px;  
        right: 20px;  
        z-index: 99;  
        border: none;  
        outline: none;  
        background-color: transparent;  
        color:#777;  
    }

    #topBtn:hover {
        color: #007FFF;  
    }
    #botBtn:hover {
        color: #007FFF;  
    }

</style>






<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">


 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/solarized-dark.min.css"> 


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">


<link rel="stylesheet" href="https://zhitaop.github.io/css/main.css"> 


    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>

     <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/go.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/haskell.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/kotlin.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/scala.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/swift.min.js"></script> 

    <script>hljs.initHighlightingOnLoad();</script>







<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>


<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>


<script>$(document).on('click', function() { $('.collapse').collapse('hide'); })</script>
 <meta name="generator" content="Hugo 0.46" />
        

        
    </head>

    
    
    <script type="text/javascript" async
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
    

    <body>
         
        <nav class="navbar navbar-default navbar-fixed-top">

            <div class="container">

                <div class="navbar-header">

                    <a class="navbar-brand visible-xs" href="#">Multi-server broadcast system</a>

                    <button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>

                </div>

                <div class="collapse navbar-collapse">

                    
                        <ul class="nav navbar-nav">
                            
                            
                            
                            <li><a href="/"   class="myname">Zhitao</a></li>                                
                            
                            <li><a href="/post/"  >Posts</a></li>                                
                            
                            <li><a href="/project/"  >Projects</a></li>                                
                            
                            <li><a href="/about/"  >About</a></li>                                
                            
                        </ul>
                    

                    
                        <ul class="nav navbar-nav navbar-right">
                            
                                <li class="navbar-icon"><a href="mailto:pzt2154@gmail.com"><i class="fa fa-envelope-o"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://github.com/zhitaop"><i class="fa fa-github"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://www.linkedin.com/in/zhitao-pan/"><i class="fa fa-linkedin"></i></a></li>
                            
                        </ul>
                    

                </div>

            </div>

        </nav>


<main>

    <div class="item">

    
    
    

    
      

    <h4><a href="/project/project2/">Multi-server broadcast system</a></h4>
    <h5>Multi-server system for broadcasting messages between clients</h5>
    
    <a href="https://zhitaop.github.io/tags/java"><kbd class="item-tag">java</kbd></a>
    

</div>


    <br> <div class="text-justify">

<p>This is a multi-server system for broadcasting messages between clients inplemented in Java. The codes and basic introduction of the project can be found on my github repo <a href="https://github.com/zhitaop/Multi-server-broadcast-system">here</a>.</p>

<p>The message broadcasting is done by common implementation of the Socket/ServerSocket class and JSON object handling in Java, nothing too fancy. The code quality and structure can probably be improved quite a bit, like applying more software design pattern and making it more object-oriented, but that&rsquo;s not the focus of this post.</p>

<p>The part I found interesting is to about maintaining high availability in a distributed system. According to the <a href="https://en.wikipedia.org/wiki/CAP_theorem">CAP theorem</a>, a distributed system has to choose between availability and consistency in the presence of a network partition, as it&rsquo;s impossible to guarantee both. We are required to focus on availability, i.e. to ensure servers can communicate with each other as soon as possible in the event of network partitioning.</p>

<h3 id="architecture-of-the-system">Architecture of the system.</h3>

<p>The system is implemented over the TCP protocol, meaning that it&rsquo;s connection-oriented. Each server can receive multiple incoming connections from other servers or clients, but it can only make one outgoing connection to another server. In other words, the servers form a tree structure. Between any two nodes, there should always be only one connection, as more will result in abnormal behaviour of the broadcast protocol.</p>

<p>To achieve availability under network partition, I implemented a mechanism for servers to make outgoing connection to another server in the system, when the server it was originally connected to crashes.</p>

<h3 id="the-backup-algorithm">The backup algorithm</h3>

<p>In order to discuss the details of the algorithm, let&rsquo;s call the servers that is making the outgoing connection children, and the servers that is receiving incoming connection parents, similar to a tree structure. We further define a backup server for each server, which is always the parent of its parent. The servers will follow the rules below:</p>

<ul>
<li>When a server detects that its parent crashes, it will try to connect to its backup server, and set that as its new parent.</li>
<li>After a server connects to a new parent successfully, it will set up a new backup server, which is the parent of its new parent.</li>
<li>Following the above, a server will broadcast a message to all of its children to inform them that its parent has changed.</li>
<li>When a server receives a message that its parent&rsquo;s parent has changed, it will change its backup server accordingly.</li>
<li>A server would do nothing if any of its children crashes.</li>
</ul>

<p>The idea is simple: to ensure that when a server&rsquo;s parent crashes it will connect to its backup server, so that all the remaining servers in the system would form a single tree. However, what about the root of the tree which doesn&rsquo;t have a parent? To solve this, we need a few extra special rules:</p>

<ul>
<li>The first two servers (the root and its first child) in a system will not have a backup server, i.e. their backup server is null, and they will set each other as their own parent.</li>
<li>When a server without a backup detects that its parent crashes, it will choose one of its existing connected server as its parent.</li>
<li>When a server A receives a message from its parent B, that B chooses A as its new parent, A will set its backup server to null. In other words, there will always be two servers without backup server in the system.</li>
</ul>

<p>These might seem a bit complicated at a first glance, so an example with diagram would be helpful. In the following diagram, the arrows indicate a parent-child relationship, and the parent and backup server of each node is shown beside each node.</p>

<p><br>
<img src="/serverDemo1.png" alt="server state graph 1" width="300"/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <img src="/serverDemo2.png" alt="server state graph 2" width="300"/></p>

<p>a. The initial state of the system  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
b. The system after server A crashed</p>

<p><br>
<img src="/serverDemo3.png" alt="server state graph 3" width="200"/></p>

<p>c. The system after server B crashed (D,E,F fisrt connect to C, then C chooses F as its new parent)</p>

<p>Hopefully, we can see from the above example how the system works. This mechanism ensures that a single tree structure is always maintained in the system, and there will be only one connection between any two nodes. Therefore, availability is achieved(to some extent) under netwrok partitioning.</p>

<h3 id="flaws">Flaws</h3>

<p>This mechanism assumes that only one server would crash at a time. Imagine the scenario where a server&rsquo;s parent and backup both crashes at the same time, before the server can connect to the backup. Then the server would try to connect to a server(its backup) that&rsquo;s no longer available, which would of course fail. Although this simultaneous crash is unlikely to happen, it&rsquo;s still a flaw in the system.</p>
</div>

    <button onclick="topFunction()" id="topBtn" title="Go to top"><i class="fa fa-chevron-circle-up" style="font-size: 30px;"></i></button>
    <button onclick="botFunction()" id="botBtn" title="Go to top"><i class="fa fa-chevron-circle-down" style="font-size: 30px;"></i></button>

    
    

    

    

        <h4 class="page-header">Comments</h4>

        <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "Zhitao" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    

</main>

        <footer>

            <p class="copyright text-muted">&copy; All rights reserved. Powered by <a href="https://gohugo.io">Hugo</a> and <a href="https://github.com/calintat/minimal">Minimal</a></p>

        </footer>
       
    </body>

    <script>
            window.onscroll = function() {scrollFunction()};
        
        function scrollFunction() {
            if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                document.getElementById("topBtn").style.display = "block";
            } else {
                document.getElementById("topBtn").style.display = "none";
            }
            if (document.body.scrollTop+700 > $(document).height() || document.documentElement.scrollTop+700 > $(document).height()) {
                document.getElementById("botBtn").style.display = "none";
            } else {
                document.getElementById("botBtn").style.display = "block";
            }
        }
        
        
        function topFunction() {
            document.body.scrollTop = 0; 
            document.documentElement.scrollTop = 0; 
        }
        function botFunction() {
            document.body.scrollTop = $(document).height(); 
            document.documentElement.scrollTop = $(document).height();
        }
    </script>
</html>

